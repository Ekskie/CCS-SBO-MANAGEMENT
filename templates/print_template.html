<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LSPU - List of Organization Members</title>
    <!-- We must link to a static CSS file for printing to work -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/printing.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Times+New+Roman&display=swap" rel="stylesheet">
</head>

<body>

    <button id="printButton" style="position: fixed; top: 20px; right: 20px; padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-family: 'Times New Roman', Times, serif;">Print Document</button>

    <!-- 
    Jinja logic to handle pagination.
    - Page 1: Sample Format + 8 members
    - Page 2+: No Sample Format + 10 members
    -->

    {% set members_per_page = 8 %}
    {% set members_per_subsequent_page = 10 %}

    <!-- --- PAGE 1 --- -->
    <div class="container page-break">
        <header>
            <img src="{{ url_for('static', filename='image/lspu.png') }}" alt="LSPU Logo">
            <div class="header-text">
                <p>Republic of the Philippines</p>
                <p><span>Laguna State Polytechnic University</span></p>
                <p>Province of Laguna</p>
            </div>
        </header>

        <div class="title-section">
            <h2>OFFICE OF STUDENT AFFAIRS AND SERVICES</h2>
            <p style="font-size: 10pt;"></p>
            <h3>LIST OF MEMBERS OF THE ORGANIZATION</h3>
            <!-- AUTOMATED FIELDS -->
            <p><b>{{ semester_display }} / {{ academic_year }}</b></p>
        </div>

        <div class="org-name-section">
            <label><b style="font-size: 12pt;">Name of Organization</b> <u style="font-size: 10pt;">COLLEGE OF COMPUTER
                    STUDIES – STUDENT BODY ORGANIZATION</u></label>
        </div>

        <!-- This sample format only appears on the first page -->
        <div class="sample-format">
            <p class="spHeader">SAMPLE FORMAT:</p>
            <div class="format-card">
                <div class="picture-placeholder small">1 x 1 <br> PICTURE</div>
                <div class="format-details">
                    <p class="sample-line">(Signature Over Printed Name)</p>
                    <p class="sample-line">(Student Number)</p>
                    <p class="sample-line">(Course / Year Section)</p>
                </div>
            </div>
        </div>

        <main class="member-grid first-page">
            <!-- Loop for first 8 members -->
            {% for member in members[:members_per_page] %}
            <div class="member-card">
                <div class="picture-placeholder">
                    <!-- Add a fallback to a default static image -->
                    <img src="{{ member.picture_url or url_for('static', filename='image/default_avatar.png') }}" alt="Student Photo">
                </div>
                <div>
                    <img class="Student-signature"
                        src="{{ member.signature_url or url_for('static', filename='image/default_signature.png') }}"
                        alt="Signature"
                        style="width: 100px; position: absolute; transform: translate(40px, -55px); mix-blend-mode:darken; aspect-ratio: 1/1;">
                    <input type="text" class="member-name" value="{{ member.full_name | upper }}" readonly>
                    <input type="text" class="member-info" value="{{ member.student_id }}" readonly>
                    <input type="text" class="member-info" value="{{ member.course }}" readonly>
                </div>
            </div>
            {% endfor %}
        </main>

        <footer>
            <div class="advisers">
                <div class="adviser-col">
                    <p class="signature-name">MERVIN JOMMEL T. DE JESUS</p>
                    <p class="signature-title">Organization Adviser</p>
                    <!-- AUTOMATED DATE -->
                    <p class="signature-date">Date: <span class="fill-in-date">{{ generation_date }}</span></p>
                </div>
                <div class="adviser-col">
                    <p class="signature-name">LOUIE JEROME L. ROLDAN</p>
                    <p class="signature-title">Organization Adviser</p>
                    <!-- AUTOMATED DATE -->
                    <p class="signature-date">Date: <span class="fill-in-date">{{ generation_date }}</span></p>
                </div>
            </div>

            <div class="approvals">
                <div class="approval-block">
                    <p></p>
                    <p class="approval-label dean">Noted:</p>
                    <p class="signature-name no-border dean">FRANCIS F. BALAHADIA, DIT</p>
                    <p class="signature-title dean">Dean/Assoc. Dean of College</p>
                </div>
                <div class="approval-block">
                    <p></p>
                    <p class="approval-label">Recommending Approval:</p>
                    <p class="signature-name no-border">NIÑO EMMANUEL ALDI L. ASTOVEZA</p>
                    <p class="signature-title">Head, Student Organization and Activities Unit</p>
                </div>

                <div class="approval-block">
                    <p></p>
                    <p class="approval-label">Approved / Disapproved:</p>
                    <p class="signature-name no-border">JEANFEL J. CASIÑO</p>
                    <p class="signature-title">Director/Chairperson, Office of Student Affairs and Services</p>
                </div>
            </div>
            <div class="doc-info">
                <p>LSPU-OSAS-SF-005 </p>
                <p>Rev. 1</p>
                <p>09 November 2020</p>
            </div>
        </footer>
    </div>

    <!-- --- SUBSEQUENT PAGES --- -->
    <!-- Check if there are more members to print -->
    {% if members|length > members_per_page %}
        <!-- Loop through the *rest* of the members, 10 at a time -->
        {% for page in members[members_per_page:] | batch(members_per_subsequent_page) %}
        <div class="container page-break">
            <!-- Header is the same -->
            <header>
                 <img src="{{ url_for('static', filename='image/lspu.png') }}" alt="LSPU Logo">
                <div class="header-text">
                    <p>Republic of the Philippines</p>
                    <p><span>Laguna State Polytechnic University</span></p>
                    <p>Province of Laguna</p>
                </div>
            </header>

            <!-- Title is the same -->
            <div class="title-section">
                <h2>OFFICE OF STUDENT AFFAIRS AND SERVICES</h2>
                <p style="font-size: 10pt;"></p>
                <h3>LIST OF MEMBERS OF THE ORGANIZATION</h3>
                <p><b>{{ semester_display }} / {{ academic_year }}</b></p>
            </div>

            <!-- Org name is the same -->
            <div class="org-name-section">
                <label><b style="font-size: 12pt;">Name of Organization</b> <u style="font-size: 10pt;">COLLEGE OF
                        COMPUTER
                        STUDIES – STUDENT BODY ORGANIZATION</u></label>
            </div>

            <!-- NO SAMPLE FORMAT on this page -->

            <!-- This grid can fit 10 members -->
            <main class="member-grid subsequent-page">
                {% for member in page %}
                <div class="member-card">
                    <div class="picture-placeholder">
                         <img src="{{ member.picture_url or url_for('static', filename='image/default_avatar.png') }}" alt="Student Photo">
                    </div>
                    <div>
                        <img class="Student-signature"
                            src="{{ member.signature_url or url_for('static', filename='image/default_signature.png') }}"
                            alt="Signature"
                            style="width: 100px; position: absolute; transform: translate(40px, -55px); mix-blend-mode:darken; aspect-ratio: 1/1;">
                        <input type="text" class="member-name" value="{{ member.full_name | upper }}" readonly>
                        <input type="text" class="member-info" value="{{ member.student_id }}" readonly>
                        <input type="text" class="member-info" value="{{ member.course }}" readonly>
                    </div>
                </div>
                {% endfor %}
            </main>

            <!-- Footer is the same -->
            <footer>
                <div class="advisers">
                    <div class="adviser-col">
                        <p class="signature-name">MERVIN JOMMEL T. DE JESUS</p>
                        <p class="signature-title">Organization Adviser</p>
                        <p class="signature-date">Date: <span class="fill-in-date">{{ generation_date }}</span></p>
                    </div>
                    <div class="adviser-col">
                        <p class="signature-name">LOUIE JEROME L. ROLDAN</p>
                        <p class="signature-title">Organization Adviser</p>
                        <p class="signature-date">Date: <span class="fill-in-date">{{ generation_date }}</span></p>
                    </div>
                </div>

                <div class="approvals">
                    <div class="approval-block">
                        <p></p>
                        <p class="approval-label dean">Noted:</p>
                        <p class="signature-name no-border dean">FRANCIS F. BALAHADIA, DIT</p>
                        <p class="signature-title dean">Dean/Assoc. Dean of College</p>
                    </div>
                    <div class="approval-block">
                        <p></p>
                        <p class="approval-label">Recommending Approval:</p>
                        <p class="signature-name no-border">NIÑO EMMANUEL ALDI L. ASTOVEZA</p>
                        <p class="signature-title">Head, Student Organization and Activities Unit</p>
                    </div>

                    <div class="approval-block">
                        <p></p>
                        <p class="approval-label">Approved / Disapproved:</p>
                        <p class="signature-name no-border">JEANFEL J. CASIÑO</p>
                        <p class="signature-title">Director/Chairperson, Office of Student Affairs and Services</p>
                    </div>
                </div>
                <div class="doc-info">
                    <p>LSPU-OSAS-SF-005 </p>
                    <p>Rev. 1</p>
                    <p>09 November 2020</p>
                </div>
            </footer>
        </div>
        {% endfor %}
    {% endif %}


    <script>
        document.getElementById('printButton').addEventListener('click', function () {
            window.print();
        });

        // Hide the print button when printing
        const style = document.createElement('style');
        style.textContent = `
            @media print { 
                #printButton { display: none; } 
                .page-break { page-break-after: always; }
            }
        `;
        document.head.appendChild(style);


        // --- Text Fit Logic ---
        // This function auto-shrinks font size to fit the name
        function fitTextToInput(input) {
            const maxFontSize = 11; // base font size (pt)
            const minFontSize = 6;  // smallest allowed font
            let fontSize = maxFontSize;
            
            // Create a hidden span to measure text width
            const testSpan = document.createElement('span');
            testSpan.style.visibility = 'hidden';
            testSpan.style.whiteSpace = 'nowrap';
            testSpan.style.position = 'absolute';
            testSpan.style.fontFamily = window.getComputedStyle(input).fontFamily;
            testSpan.style.textTransform = window.getComputedStyle(input).textTransform;
            testSpan.style.fontWeight = window.getComputedStyle(input).fontWeight;
            document.body.appendChild(testSpan);

            testSpan.textContent = input.value;
            testSpan.style.fontSize = fontSize + 'pt';

            // Reduce font size until text fits
            while (testSpan.offsetWidth > input.clientWidth && fontSize > minFontSize) {
                fontSize -= 0.5;
                testSpan.style.fontSize = fontSize + 'pt';
            }

            input.style.fontSize = fontSize + 'pt';
            document.body.removeChild(testSpan);
        }

        // Run the fit-text function when the page loads
        window.addEventListener("load", function () {
            const inputs = document.querySelectorAll('.member-name');
            inputs.forEach(input => {
                fitTextToInput(input);
            });
        });

        // Re-run the fit-text function right before printing
        window.addEventListener('beforeprint', function () {
            const inputs = document.querySelectorAll('.member-name');
            inputs.forEach(input => {
                fitTextToInput(input);
            });
        });

    </script>
</body>

</html>

